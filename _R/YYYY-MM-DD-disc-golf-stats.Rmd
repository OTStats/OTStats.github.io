---
title: "Disc Golf Stats"
date: YYYY-MM-DD
category: cat
tags: [tag1, tag2, tag3]
---

A few months into my (2020) quarantine one of my neighbors took me disc golfing. 
It wasn't an entirely new experience for me, as I had gone a few times when I was younger, but this time around I was interested. 
In the days that followed I watched previous PDGA (Professional Disc Golf Association) events -- catching a glimpse of how the discs are __supposed__ to behave. 
The next week I bought a starter pack. 
My fascination has since continued...

***

As I've gone on to watch a few of the professional disc golf events I've gotten familiar with some of the pros currently at the top of the game. 
Players such as Paul Mcbeth, Ricky Wysocki, Eagle McMahon, and Calvin Heimburg were regularly appearing in the final rounds of events. 
I began to wonder how much these professionals have earned (specifically, their winnings from each of these tournaments; I'm sure some make a decent amount from endorsements). 
Luckily the PDGA tracks most of this information for us. 
The PDGA website [Player Statistics](https://www.pdga.com/players/stats) page tracks annual earnings, ratings, and points for players back to 1979. 



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache = TRUE)
```

```{r web scraping}
library(tidyverse)
library(rvest)
library(xml2)


# Read single page, rankings for 2019
url <- "https://www.pdga.com/players/stats?Year=2019&player_Class=All&Gender=All&Bracket=All&continent=All&Country=All&StateProv=All&page=0"

url %>% 
  xml2::read_html() %>% 
  html_node("body") %>% 
  html_children() %>% 
  xml2::xml_find_first("//table") %>% 
  rvest::html_table() %>% 
  .[[1]] %>% 
  as_tibble()


# -----------------. 

url <- "https://www.pdga.com/players/stats?Year=2019&player_Class=All&Gender=All&Bracket=All&continent=All&Country=All&StateProv=All&page=0"

num_of_records <- url %>% 
  xml2::read_html() %>% 
  html_node("body") %>% 
  html_children() %>% 
  xml2::xml_find_first("//div[contains(@class, 'view-footer')]") %>% 
  html_children() %>% 
  .[1] %>% 
  as.character() %>% 
  str_extract(., "(?<= of )(.[:digit:]+)") %>% 
  as.numeric()

# ---- determine the number of pages that would need to be read for 2019
(num_of_records %/% 20) + 1 * ((num_of_records %% 20) != 0)

install.packages("polite")
library(polite)
polite::bow()


session <- bow(url)
session %>% 
  scrape() %>% 
  html_node("body") %>% 
  xml2::xml_find_first("//table") %>% 
  html_table() %>% 
  as_tibble()

session %>% 
  scrape() %>% 
  html_node("body") %>% 
  xml2::xml_find_first("//div[contains(@class, 'view-footer')]") %>% 
  html_children() %>% 
  as.character() %>% 
  str_extract(., "(?<= of )(.[:digit:]+)") %>% 
  as.numeric()
  
  # xml2::read_html() %>% 
  # html_children() %>% 
  # .[1] %>% 
  # as.character() %>% 
  # as.numeric()


base = "https://www.pdga.com/players/stats?Year=2019&player_Class=All&Gender=All&Bracket=All&continent=All&Country=All&StateProv=All&page="



scrape_page <- function(url) {
  url_session = bow(url)
  url_session %>% 
    scrape() %>% 
    html_node("body") %>% 
    xml2::xml_find_first("//table") %>% 
    html_table() %>% 
    as_tibble()
}

str_c(base, 0:5) %>% 
  map_df(~ scrape_page(url = .))

```
  
```{r}
base_1 = "https://www.pdga.com/players/stats?Year="
base_2 = "&player_Class=1&Gender=Male&Bracket=MPO&continent=All&Country=All&StateProv=All&order=Prize&sort=desc&page=0"

df <- str_c(base_1, 2010:2020, base_2) %>% 
  map_df(~ scrape_page(url = .))

df %>% 
  group_by(Name) %>% 
  mutate(Cash = str_remove_all(Cash, "\\$|,") %>% as.numeric()) %>% 
  summarize(total_cash = sum(Cash)) %>% 
  arrange(desc(total_cash))
```
